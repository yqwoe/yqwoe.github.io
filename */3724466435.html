<!DOCTYPE html><html><head><meta charset="utf-8"><title>k8s 1.19.2 éƒ¨ç½² traefik 2.2 | rm -rf /*</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico"><link rel="mask-icon" href="{{ url_for(theme.favicon.safari_pinned_tab) }}" color="{{ theme.android_chrome_color }}"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/search.css"><link rel="stylesheet" href="/css/katex.min.css"><link rel="stylesheet" href="/css/googleapis.css"><link rel="stylesheet" href="/css/highlight.css"><meta name="description" content="k8s 1.19.2éƒ¨ç½² traefik 2.2"><meta property="og:type" content="article"><meta property="og:title" content="k8s 1.19.2 éƒ¨ç½² traefik 2.2"><meta property="og:url" content="https://rm-rf.ink/*/3724466435.html"><meta property="og:site_name" content="rm -rf &#x2F;*"><meta property="og:description" content="k8s 1.19.2éƒ¨ç½² traefik 2.2"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2020-11-13T03:05:00.000Z"><meta property="article:modified_time" content="2024-01-10T12:52:15.708Z"><meta property="article:author" content="Yq Woe"><meta property="article:tag" content="k8s"><meta property="article:tag" content="docker"><meta property="article:tag" content="å®¹å™¨æŠ€æœ¯"><meta property="article:tag" content="traefik2"><meta name="twitter:card" content="summary"><link rel="stylesheet" href="/css/reveal.css"><meta name="generator" content="Hexo 7.1.1"><link rel="alternate" href="/atom.xml" title="rm -rf /*" type="application/atom+xml">
</head><body><div id="wrapper"><header id="header"><div class="poem-wrap"><div class="poem-border poem-left"></div><div class="poem-border poem-right"></div><h1><a href="/">rm -rf /*</a></h1><p id="poem">åŠ è½½ä¸­...</p><p id="info"></div><nav><a class="nav-link" href="/">é¦–é¡µ</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/categories">åˆ†ç±»</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/tags">æ ‡ç­¾</a> <span class="nav-spacer">x</span> <a class="nav-link" href="/about">å…³äº</a></nav></header><div id="content"><article id="post-2020-11-13- traefik2 éƒ¨ç½²" class="article article-type-post" itemprop="blogPost" itemscope><div class="article-inner"><header class="article-header"><h2 class="article-title" itemprop="headline name">k8s 1.19.2 éƒ¨ç½² traefik 2.2</h2><div class="article-meta"><time class="article-date" datetime="2020-11-13T03:05:00.000Z" itemprop="datePublished">2020.11.13 11:05 ä¸Šåˆ</time></div></header><div class="article-entry" itemprop="articleBody"><div id="toc" class="toc-article"><div class="toc-title">ç›®å½•</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80-traefik-%E7%AE%80%E4%BB%8B"><span class="toc-text">ä¸€ã€Traefik ç®€ä»‹</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C-kubernetes-%E9%83%A8%E7%BD%B2-traefik"><span class="toc-text">äºŒã€Kubernetes éƒ¨ç½² Traefik</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ingress-routeyml"><span class="toc-text">1ã€ingress-route.yml</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%88%9B%E5%BB%BA-rbac-%E6%9D%83%E9%99%90"><span class="toc-text">2ã€åˆ›å»º RBAC æƒé™</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%88%9B%E5%BB%BA-traefik-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-text">3ã€åˆ›å»º Traefik é…ç½®æ–‡ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E8%8A%82%E7%82%B9%E8%AE%BE%E7%BD%AE-label-%E6%A0%87%E7%AD%BE"><span class="toc-text">4ã€èŠ‚ç‚¹è®¾ç½® Label æ ‡ç­¾</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-kubernetes-%E9%83%A8%E7%BD%B2-traefik"><span class="toc-text">5ã€Kubernetes éƒ¨ç½² Traefik</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89-traefik-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99%E9%85%8D%E7%BD%AE"><span class="toc-text">ä¸‰ã€Traefik è·¯ç”±è§„åˆ™é…ç½®</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E9%85%8D%E7%BD%AE-http-%E8%B7%AF%E7%94%B1%E8%A7%84%E5%88%99-traefik-dashboard-%E4%B8%BA%E4%BE%8B"><span class="toc-text">1ã€é…ç½® HTTP è·¯ç”±è§„åˆ™ ï¼ˆTraefik Dashboard ä¸ºä¾‹ï¼‰</span></a></li></ol></li></ol></div><p><strong>ç³»ç»Ÿç¯å¢ƒï¼š</strong></p><span id="more"></span><ul class="lvl-0"><li class="lvl-2"><p>Traefik ç‰ˆæœ¬ï¼šv2.2</p></li><li class="lvl-2"><p>Kubernetes ç‰ˆæœ¬ï¼š1.19.2</p></li></ul><p><strong>åœ°å€ï¼š</strong></p><ul class="lvl-0"><li class="lvl-2"><p>Traefik 2.2 å®˜æ–¹æ–‡æ¡£ï¼š<a target="_blank" rel="noopener" href="https://doc.traefik.io/traefik/v2.2/">https://doc.traefik.io/traefik/v2.2/</a></p></li></ul><h2 id="ä¸€-traefik-ç®€ä»‹"><a class="markdownIt-Anchor" href="#ä¸€-traefik-ç®€ä»‹"></a> ä¸€ã€Traefik ç®€ä»‹</h2><p>Traefik æœ€æ–°æ¨å‡ºäº† v2.2 ç‰ˆæœ¬ï¼Œè¿™é‡Œå°† Traefik å‡çº§åˆ°æœ€æ–°ç‰ˆæœ¬ï¼Œç®€å•çš„ä»‹ç»äº†ä¸‹å¦‚ä½•åœ¨ Kubernetes ç¯å¢ƒä¸‹å®‰è£… Traefik v2.2</p><h2 id="äºŒ-kubernetes-éƒ¨ç½²-traefik"><a class="markdownIt-Anchor" href="#äºŒ-kubernetes-éƒ¨ç½²-traefik"></a> äºŒã€Kubernetes éƒ¨ç½² Traefik</h2><blockquote><p>æ³¨æ„ï¼šè¿™é‡Œ Traefik æ˜¯éƒ¨ç½²åœ¨ Kube-system Namespace ä¸‹ï¼Œä½¿ç”¨kustomizeéƒ¨ç½²ã€‚</p></blockquote><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">-rw-r--r--  1 yqwoe  staff   287 11 23 09:54 cluster-role-binding.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff   736 11 23 09:54 cluster-role.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff  2578 11 23 09:54 config.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff  1110 11 23 09:54 daemon-set.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff  2021 11 23 09:54 ingress-route.yml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff   268 11 23 09:54 kustomization.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff    81 11 23 09:54 service-account.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff   220 11 23 09:54 service.yaml</span><br><span class="line">-rw-r--r--  1 yqwoe  staff   257 11 23 09:54 traefik-dashboard-route.yml</span><br></pre></td></tr></table></figure><p><strong>kustomization.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">kustomize.config.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Kustomization</span></span><br><span class="line"></span><br><span class="line"><span class="attr">resources:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">cluster-role.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">cluster-role-binding.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">service-account.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">config.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">daemon-set.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">service.yaml</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">ingress-route.yaml</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">kube-system</span></span><br><span class="line"></span><br><span class="line"><span class="attr">commonLabels:</span></span><br><span class="line">  <span class="attr">app:</span> <span class="string">traefik</span></span><br></pre></td></tr></table></figure><h3 id="1-ingress-routeyml"><a class="markdownIt-Anchor" href="#1-ingress-routeyml"></a> 1ã€ingress-route.yml</h3><p>åœ¨ traefik v2.1 ç‰ˆæœ¬åï¼Œå¼€å§‹ä½¿ç”¨ CRDï¼ˆCustom Resource Definitionï¼‰æ¥å®Œæˆè·¯ç”±é…ç½®ç­‰ï¼Œæ‰€ä»¥éœ€è¦æå‰åˆ›å»º CRD èµ„æºã€‚</p><p><strong>åˆ›å»º ingress-route.yml æ–‡ä»¶</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingressroutes.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IngressRoute</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ingressroutes</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ingressroute</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">middlewares.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">Middleware</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">middlewares</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">middleware</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingressroutetcps.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IngressRouteTCP</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ingressroutetcps</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ingressroutetcp</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">ingressrouteudps.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">IngressRouteUDP</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">ingressrouteudps</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">ingressrouteudp</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tlsoptions.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">TLSOption</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">tlsoptions</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">tlsoption</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">tlsstores.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">TLSStore</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">tlsstores</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">tlsstore</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br><span class="line"></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apiextensions.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">CustomResourceDefinition</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefikservices.traefik.containo.us</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">group:</span> <span class="string">traefik.containo.us</span></span><br><span class="line">  <span class="attr">version:</span> <span class="string">v1alpha1</span></span><br><span class="line">  <span class="attr">names:</span></span><br><span class="line">    <span class="attr">kind:</span> <span class="string">TraefikService</span></span><br><span class="line">    <span class="attr">plural:</span> <span class="string">traefikservices</span></span><br><span class="line">    <span class="attr">singular:</span> <span class="string">traefikservice</span></span><br><span class="line">  <span class="attr">scope:</span> <span class="string">Namespaced</span></span><br></pre></td></tr></table></figure><h3 id="2-åˆ›å»º-rbac-æƒé™"><a class="markdownIt-Anchor" href="#2-åˆ›å»º-rbac-æƒé™"></a> 2ã€åˆ›å»º RBAC æƒé™</h3><p>Kubernetes åœ¨ 1.6 ç‰ˆæœ¬ä¸­å¼•å…¥äº†åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰ç­–ç•¥ï¼Œæ–¹ä¾¿å¯¹ Kubernetes èµ„æºå’Œ API è¿›è¡Œç»†ç²’åº¦æ§åˆ¶ã€‚Traefik éœ€è¦ä¸€å®šçš„æƒé™ï¼Œæ‰€ä»¥è¿™é‡Œæå‰åˆ›å»ºå¥½ Traefik ServiceAccount å¹¶åˆ†é…ä¸€å®šçš„æƒé™ã€‚</p><p><strong>åˆ›å»º service-account.yaml æ–‡ä»¶</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-controller</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºcluster-role.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-controller</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">services</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">endpoints</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">secrets</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">extensions</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingresses/status</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">update</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">traefik.containo.us</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">middlewares</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingressroutes</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">traefikservices</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingressroutetcps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">ingressrouteudps</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tlsoptions</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">tlsstores</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">watch</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºcluster-role-binding.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1beta1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-controller</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line">  <span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line">  <span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-controller</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-ingress-controller</span></span><br></pre></td></tr></table></figure><h3 id="3-åˆ›å»º-traefik-é…ç½®æ–‡ä»¶"><a class="markdownIt-Anchor" href="#3-åˆ›å»º-traefik-é…ç½®æ–‡ä»¶"></a> 3ã€åˆ›å»º Traefik é…ç½®æ–‡ä»¶</h3><p>ç”±äº Traefik é…ç½®å¾ˆå¤šï¼Œé€šè¿‡ CLI å®šä¹‰ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Œä¸€èˆ¬æ—¶å€™é€‰æ‹©å°†å…¶é…ç½®é€‰é¡¹æ”¾åˆ°é…ç½®æ–‡ä»¶ä¸­ï¼Œç„¶åå­˜å…¥ ConfigMapï¼Œå°†å…¶æŒ‚å…¥ traefik ä¸­ã€‚</p><p><strong>åˆ›å»º config.yaml æ–‡ä»¶</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">ConfigMap</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-config</span></span><br><span class="line"><span class="attr">data:</span></span><br><span class="line">  <span class="attr">traefik.yaml:</span> <span class="string">|-</span></span><br><span class="line"><span class="string">    ping: &quot;&quot;                    ## å¯ç”¨ Ping</span></span><br><span class="line"><span class="string">    serversTransport:</span></span><br><span class="line"><span class="string">      insecureSkipVerify: true  ## Traefik å¿½ç•¥éªŒè¯ä»£ç†æœåŠ¡çš„ TLS è¯ä¹¦</span></span><br><span class="line"><span class="string">    api:</span></span><br><span class="line"><span class="string">      insecure: true            ## å…è®¸ HTTP æ–¹å¼è®¿é—® API</span></span><br><span class="line"><span class="string">      dashboard: true           ## å¯ç”¨ Dashboard</span></span><br><span class="line"><span class="string">      debug: false              ## å¯ç”¨ Debug è°ƒè¯•æ¨¡å¼</span></span><br><span class="line"><span class="string">    metrics:</span></span><br><span class="line"><span class="string">      prometheus: &quot;&quot;            ## é…ç½® Prometheus ç›‘æ§æŒ‡æ ‡æ•°æ®ï¼Œå¹¶ä½¿ç”¨é»˜è®¤é…ç½®</span></span><br><span class="line"><span class="string">    entryPoints:</span></span><br><span class="line"><span class="string">      web:</span></span><br><span class="line"><span class="string">        address: &quot;:80&quot;          ## é…ç½® 80 ç«¯å£ï¼Œå¹¶è®¾ç½®å…¥å£åç§°ä¸º web</span></span><br><span class="line"><span class="string">      websecure:</span></span><br><span class="line"><span class="string">        address: &quot;:443&quot;         ## é…ç½® 443 ç«¯å£ï¼Œå¹¶è®¾ç½®å…¥å£åç§°ä¸º websecure</span></span><br><span class="line"><span class="string">    providers:</span></span><br><span class="line"><span class="string">      kubernetesCRD: &quot;&quot;         ## å¯ç”¨ Kubernetes CRD æ–¹å¼æ¥é…ç½®è·¯ç”±è§„åˆ™</span></span><br><span class="line"><span class="string">      kubernetesIngress: &quot;&quot;     ## å¯åŠ¨ Kubernetes Ingress æ–¹å¼æ¥é…ç½®è·¯ç”±è§„åˆ™</span></span><br><span class="line"><span class="string">    log:</span></span><br><span class="line"><span class="string">      filePath: &quot;&quot;              ## è®¾ç½®è°ƒè¯•æ—¥å¿—æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œå¦‚æœä¸ºç©ºåˆ™è¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line"><span class="string">      level: error              ## è®¾ç½®è°ƒè¯•æ—¥å¿—çº§åˆ«</span></span><br><span class="line"><span class="string">      format: json              ## è®¾ç½®è°ƒè¯•æ—¥å¿—æ ¼å¼</span></span><br><span class="line"><span class="string">    accessLog:</span></span><br><span class="line"><span class="string">      filePath: &quot;&quot;              ## è®¾ç½®è®¿é—®æ—¥å¿—æ–‡ä»¶å­˜å‚¨è·¯å¾„ï¼Œå¦‚æœä¸ºç©ºåˆ™è¾“å‡ºåˆ°æ§åˆ¶å°</span></span><br><span class="line"><span class="string">      format: json              ## è®¾ç½®è®¿é—®è°ƒè¯•æ—¥å¿—æ ¼å¼</span></span><br><span class="line"><span class="string">      bufferingSize: 0          ## è®¾ç½®è®¿é—®æ—¥å¿—ç¼“å­˜è¡Œæ•°</span></span><br><span class="line"><span class="string">      filters:</span></span><br><span class="line"><span class="string">        #statusCodes: [&quot;200&quot;]   ## è®¾ç½®åªä¿ç•™æŒ‡å®šçŠ¶æ€ç èŒƒå›´å†…çš„è®¿é—®æ—¥å¿—</span></span><br><span class="line"><span class="string">        retryAttempts: true     ## è®¾ç½®ä»£ç†è®¿é—®é‡è¯•å¤±è´¥æ—¶ï¼Œä¿ç•™è®¿é—®æ—¥å¿—</span></span><br><span class="line"><span class="string">        minDuration: 20         ## è®¾ç½®ä¿ç•™è¯·æ±‚æ—¶é—´è¶…è¿‡æŒ‡å®šæŒç»­æ—¶é—´çš„è®¿é—®æ—¥å¿—</span></span><br><span class="line"><span class="string">      fields:                   ## è®¾ç½®è®¿é—®æ—¥å¿—ä¸­çš„å­—æ®µæ˜¯å¦ä¿ç•™ï¼ˆkeep ä¿ç•™ã€drop ä¸ä¿ç•™ï¼‰</span></span><br><span class="line"><span class="string">        defaultMode: keep       ## è®¾ç½®é»˜è®¤ä¿ç•™è®¿é—®æ—¥å¿—å­—æ®µ</span></span><br><span class="line"><span class="string">        names:                  ## é’ˆå¯¹è®¿é—®æ—¥å¿—ç‰¹åˆ«å­—æ®µç‰¹åˆ«é…ç½®ä¿ç•™æ¨¡å¼</span></span><br><span class="line"><span class="string">          ClientUsername: drop</span></span><br><span class="line"><span class="string">        headers:                ## è®¾ç½® Header ä¸­å­—æ®µæ˜¯å¦ä¿ç•™</span></span><br><span class="line"><span class="string">          defaultMode: keep     ## è®¾ç½®é»˜è®¤ä¿ç•™ Header ä¸­å­—æ®µ</span></span><br><span class="line"><span class="string">          names:                ## é’ˆå¯¹ Header ä¸­ç‰¹åˆ«å­—æ®µç‰¹åˆ«é…ç½®ä¿ç•™æ¨¡å¼</span></span><br><span class="line"><span class="string">            User-Agent: redact</span></span><br><span class="line"><span class="string">            Authorization: drop</span></span><br><span class="line"><span class="string">            Content-Type: keep</span></span><br><span class="line"><span class="string">    certificatesresolvers:</span></span><br><span class="line"><span class="string">      default:</span></span><br><span class="line"><span class="string">        acme:</span></span><br><span class="line"><span class="string">          tlsChallenge: true</span></span><br><span class="line"><span class="string">          email: &quot;yqwoe@live.cn&quot;</span></span><br><span class="line"><span class="string">          storage: &quot;acme.json&quot;</span></span><br><span class="line"><span class="string">          caserver: &quot;https://acme-v02.api.letsencrypt.org/directory&quot;</span></span><br></pre></td></tr></table></figure><h3 id="4-èŠ‚ç‚¹è®¾ç½®-label-æ ‡ç­¾"><a class="markdownIt-Anchor" href="#4-èŠ‚ç‚¹è®¾ç½®-label-æ ‡ç­¾"></a> 4ã€èŠ‚ç‚¹è®¾ç½® Label æ ‡ç­¾</h3><p>ç”±äºæ˜¯ Kubernetes DeamonSet è¿™ç§æ–¹å¼éƒ¨ç½² Traefikï¼Œæ‰€ä»¥éœ€è¦æå‰ç»™èŠ‚ç‚¹è®¾ç½® Labelï¼Œè¿™æ ·å½“ç¨‹åºéƒ¨ç½²æ—¶ Pod ä¼šè‡ªåŠ¨è°ƒåº¦åˆ°è®¾ç½® Label çš„èŠ‚ç‚¹ä¸Šã€‚</p><p><strong>èŠ‚ç‚¹è®¾ç½® Label æ ‡ç­¾</strong></p><ul class="lvl-0"><li class="lvl-2"><p>æ ¼å¼ï¼škubectl label nodes [èŠ‚ç‚¹å] [key=value]</p></li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl label nodes minikube IngressProxy=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p><strong>æŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦è®¾ç½® Label æˆåŠŸ</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl get nodes --show-labels</span><br><span class="line"></span><br><span class="line">NAME       STATUS   ROLES    AGE   VERSION   LABELS</span><br><span class="line">minikube   Ready    master   3d    v1.19.2   IngressProxy=<span class="literal">true</span>,beta.kubernetes.io/arch=amd64,beta.kubernetes.io/os=linux,kubernetes.io/arch=amd64,kubernetes.io/hostname=minikube,kubernetes.io/os=linux,minikube.k8s.io/commit=b09ee50ec047410326a85435f4d99026f9c4f5c4,minikube.k8s.io/name=minikube,minikube.k8s.io/updated_at=2020_11_10T10_20_51_0700,minikube.k8s.io/version=v1.14.0,node-role.kubernetes.io/master=</span><br></pre></td></tr></table></figure><blockquote><p>å¦‚æœæƒ³åˆ é™¤æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨ <code>kubectl label nodes minikube IngressProxy-</code> å‘½ä»¤</p></blockquote><h3 id="5-kubernetes-éƒ¨ç½²-traefik"><a class="markdownIt-Anchor" href="#5-kubernetes-éƒ¨ç½²-traefik"></a> 5ã€Kubernetes éƒ¨ç½² Traefik</h3><p>DaemonSet æ–¹å¼éƒ¨ç½²ï¼Œä¾¿äºåœ¨å¤šæœåŠ¡å™¨é—´æ‰©å±•ï¼Œç”¨ hostport æ–¹å¼å ç”¨æœåŠ¡å™¨ 80ã€443 ç«¯å£ï¼Œæ–¹ä¾¿æµé‡è¿›å…¥ã€‚</p><p><strong>åˆ›å»º traefik éƒ¨ç½²æ–‡ä»¶ daemon-set.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">kind:</span> <span class="string">DaemonSet</span></span><br><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">template:</span></span><br><span class="line">    <span class="attr">spec:</span></span><br><span class="line">      <span class="attr">serviceAccountName:</span> <span class="string">traefik-ingress-controller</span></span><br><span class="line">      <span class="attr">terminationGracePeriodSeconds:</span> <span class="number">60</span></span><br><span class="line">      <span class="attr">containers:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">image:</span> <span class="string">traefik:v2.2</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">traefik-ingress-lb</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">80</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">80</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">websecure</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">443</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">443</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">          <span class="attr">containerPort:</span> <span class="number">8080</span></span><br><span class="line">          <span class="attr">hostPort:</span> <span class="number">8080</span></span><br><span class="line">        <span class="attr">securityContext:</span></span><br><span class="line">          <span class="attr">capabilities:</span></span><br><span class="line">            <span class="attr">drop:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ALL</span></span><br><span class="line">            <span class="attr">add:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">NET_BIND_SERVICE</span></span><br><span class="line">        <span class="attr">args:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="string">--configfile=/config/traefik.yaml</span></span><br><span class="line">        <span class="attr">volumeMounts:</span></span><br><span class="line">          <span class="bullet">-</span> <span class="attr">mountPath:</span> <span class="string">&quot;/config&quot;</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">&quot;config&quot;</span></span><br><span class="line">      <span class="attr">volumes:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">          <span class="attr">configMap:</span></span><br><span class="line">            <span class="attr">name:</span> <span class="string">traefik-config</span></span><br><span class="line">      <span class="attr">tolerations:</span>              <span class="comment">## è®¾ç½®å®¹å¿æ‰€æœ‰æ±¡ç‚¹ï¼Œé˜²æ­¢èŠ‚ç‚¹è¢«è®¾ç½®æ±¡ç‚¹</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">operator:</span> <span class="string">&quot;Exists&quot;</span></span><br><span class="line">      <span class="attr">nodeSelector:</span>             <span class="comment">## è®¾ç½®nodeç­›é€‰å™¨ï¼Œåœ¨ç‰¹å®šlabelçš„èŠ‚ç‚¹ä¸Šå¯åŠ¨</span></span><br><span class="line">        <span class="attr">IngressProxy:</span> <span class="string">&quot;true&quot;</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»ºTraefik Service service.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Service</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">web</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">80</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">websecure</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">443</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">admin</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">selector:</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">traefik</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">NodePort</span></span><br></pre></td></tr></table></figure><p>è‡³æ­¤ï¼Œtraefikçš„é…ç½®åŸºæœ¬å®Œæˆã€‚</p><p><strong>æ‰§è¡Œ kustomization.yaml</strong></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kubectl apply -k . -n kube-system</span><br></pre></td></tr></table></figure><h2 id="ä¸‰-traefik-è·¯ç”±è§„åˆ™é…ç½®"><a class="markdownIt-Anchor" href="#ä¸‰-traefik-è·¯ç”±è§„åˆ™é…ç½®"></a> ä¸‰ã€Traefik è·¯ç”±è§„åˆ™é…ç½®</h2><h3 id="1-é…ç½®-http-è·¯ç”±è§„åˆ™-traefik-dashboard-ä¸ºä¾‹"><a class="markdownIt-Anchor" href="#1-é…ç½®-http-è·¯ç”±è§„åˆ™-traefik-dashboard-ä¸ºä¾‹"></a> 1ã€é…ç½® HTTP è·¯ç”±è§„åˆ™ ï¼ˆTraefik Dashboard ä¸ºä¾‹ï¼‰</h3><p>Traefik åº”ç”¨å·²ç»éƒ¨ç½²å®Œæˆï¼Œä½†æ˜¯æƒ³è®©å¤–éƒ¨è®¿é—® Kubernetes å†…éƒ¨æœåŠ¡ï¼Œè¿˜éœ€è¦é…ç½®è·¯ç”±è§„åˆ™ï¼Œè¿™é‡Œå¼€å¯äº† Traefik Dashboard é…ç½®ï¼Œæ‰€ä»¥é¦–å…ˆé…ç½® Traefik Dashboard çœ‹æ¿çš„è·¯ç”±è§„åˆ™ï¼Œä½¿å¤–éƒ¨èƒ½å¤Ÿè®¿é—® Traefik Dashboardã€‚</p><p><strong>åˆ›å»º Traefik Dashboard è·¯ç”±è§„åˆ™æ–‡ä»¶ traefik-dashboard-route.yaml</strong></p><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">traefik.containo.us/v1alpha1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">IngressRoute</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">traefik-dashboard-route</span></span><br><span class="line"><span class="attr">spec:</span></span><br><span class="line">  <span class="attr">entryPoints:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">web</span></span><br><span class="line">  <span class="attr">routes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">match:</span> <span class="string">Host(`yqwoe.k8s.com`)</span></span><br><span class="line">      <span class="attr">kind:</span> <span class="string">Rule</span></span><br><span class="line">      <span class="attr">services:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">traefik</span></span><br><span class="line">          <span class="attr">port:</span> <span class="number">8080</span></span><br></pre></td></tr></table></figure><p><strong>åˆ›å»º Traefik Dashboard è·¯ç”±è§„åˆ™å¯¹è±¡</strong></p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ kubectl apply -f traefik-dashboard-route.yaml -n kube-system</span><br></pre></td></tr></table></figure><p><strong>æ¥ä¸‹æ¥é…ç½® Hosts</strong>ï¼Œå®¢æˆ·ç«¯æƒ³é€šè¿‡åŸŸåè®¿é—®æœåŠ¡ï¼Œå¿…é¡»è¦è¿›è¡Œ DNS è§£æï¼Œç”±äºè¿™é‡Œæ²¡æœ‰ DNS æœåŠ¡å™¨è¿›è¡ŒåŸŸåè§£æï¼Œæ‰€ä»¥ä¿®æ”¹ hosts æ–‡ä»¶å°† Traefik æŒ‡å®šèŠ‚ç‚¹çš„ IP å’Œè‡ªå®šä¹‰ host ç»‘å®šã€‚æ‰“å¼€ç”µè„‘çš„ Hosts é…ç½®æ–‡ä»¶ï¼Œå¾€å…¶åŠ å…¥ä¸‹é¢é…ç½®ï¼š</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">192.168.10.2  yqwoe.k8s.com</span><br></pre></td></tr></table></figure><p><strong>é…ç½®å®Œæˆåï¼Œæ‰“å¼€æµè§ˆå™¨è¾“å…¥åœ°å€ï¼šhttp://<code>yqwoe.k8s.com</code> æ‰“å¼€ Traefik Dashboardã€‚</strong></p></div><div class="article-category"><a class="article-category-link" href="/categories/%E5%B7%A5%E4%BD%9C/">å·¥ä½œ</a> <b>&nbsp;:åˆ†ç±»</b><br><a class="article-tag-none-link" href="/tags/docker/" rel="tag">docker</a>, <a class="article-tag-none-link" href="/tags/k8s/" rel="tag">k8s</a>, <a class="article-tag-none-link" href="/tags/traefik2/" rel="tag">traefik2</a>, <a class="article-tag-none-link" href="/tags/%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF/" rel="tag">å®¹å™¨æŠ€æœ¯</a> <b>&nbsp;:æ ‡ç­¾</b></div></div></article><nav id="article-nav" class="article-nav"><a href="/*/3382022550.html" id="article-nav-newer" class="article-nav-link-wrap newer"><strong class="article-nav-caption">ä¸Šä¸€ç¯‡</strong><div class="article-nav-title">åŸºäºk8s\traefik\springbootçš„å¾®æœåŠ¡å®è·µ</div></a><a href="/*/848869235.html" id="article-nav-older" class="article-nav-link-wrap older"><strong class="article-nav-caption">ä¸‹ä¸€ç¯‡</strong><div class="article-nav-title">ä¸€å¹´è¦èµšå¤šå°‘é’±æ‰èƒ½æ”¯æ’‘ä¸€ä¸ªä¸‰å£ä¹‹å®¶ï¼Ÿ</div></a></nav><div id="gitalk-container" style="padding:0 30px 0 30px"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script><script type="text/javascript">var gitalk=new Gitalk({clientID:"d99a4bdc344cff33585d",clientSecret:"4819ca8aa103e688f259b5ed6b3cd3fffdf0f96e",repo:"yqwoe.github.io",owner:"yqwoe",admin:["yqwoe"],id:"3724466435",distractionFreeMode:"true",title:"k8s 1.19.2 éƒ¨ç½² traefik 2.2",body:"ğŸš€"+location.href+"\n\næ¬¢è¿é€šè¿‡ issues ç•™è¨€ ï¼Œç›¸äº’äº¤æµå­¦ä¹ "});gitalk.render("gitalk-container")</script></div></div><div id="settings-container"><div id="dark-mode"></div><div id="sans-font"></div></div><span class="post-count">23.2k</span><script type="text/javascript">let d=document,r=d.documentElement.style,f=r.setProperty.bind(r),l=localStorage,s=l.getItem("s")||window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,n=l.getItem("n"),m=d.getElementById("dark-mode"),b=()=>{f("--bg-color","#fafafa"),f("--code-bg-color","#f4f4f4"),f("--text-color","#212121"),f("--secondary-color","#808080"),f("--tertiary-color","#b0b0b0"),f("--link-color","#b5c8cf"),f("--link-hover-color","#618794"),f("--link-bg-color","#dae4e7"),f("--selection-color","#dae4e7")},c=()=>{f("--bg-color","#212121"),f("--code-bg-color","#292929"),f("--text-color","#fff"),f("--secondary-color","#c0c0c0"),f("--tertiary-color","#6e6e6e"),f("--link-color","#4d6b75"),f("--link-hover-color","#96b1bb"),f("--link-bg-color","#5d828e"),f("--selection-color","#acc1c9")},o=d.getElementById("sans-font"),e=()=>{f("--body-stack",'"Lora", "Georgia", "Times New Roman", serif')},g=()=>{f("--body-stack",'"Lato", "Lucida Grande", "Lucida Sans Unicode", "Lucida Sans", "Verdana", sans-serif')};m.onclick=function(){2==s?(s=1,l.setItem("s",s),c()):(s=2,l.setItem("s",s),b())},o.onclick=function(){2==n?(n=1,l.setItem("n",n),g()):(n=2,l.setItem("n",n),e())},(s||"1"==s)&&(s=1,l.setItem("s",s),c()),s&&"2"!=s||(s=2,l.setItem("s",s),b()),n||(n=2,l.setItem("n",2)),"1"==n&&g(),"2"==n&&e()</script><script type="module">import mermaid from"https://cdn.jsdelivr.net/npm/mermaid@9.4.3/+esm";let theme=localStorage.getItem("s");mermaid.initialize({startOnLoad:!0,logLevel:"debug",theme:"2"===theme?"forest":"dark"});let mode=document.getElementById("dark-mode"),arrayGraphs=[],nodes=document.getElementsByClassName("mermaid");for(let e of nodes)console.log(e.innerHTML),arrayGraphs.push(e.innerHTML);mode.addEventListener("click",async()=>{theme=localStorage.getItem("s"),mermaid.initialize({startOnLoad:!0,logLevel:"debug",theme:"2"===theme?"forest":"dark"});for(let e=0;e<nodes.length;e++){let t=nodes[e];t.removeAttribute("data-processed"),t.setAttribute("id","mermaid-"+e),t.replaceChildren(),t.innerHTML=arrayGraphs[e],mermaid.init(void 0,t)}},!1)</script><script src="/js/jquery.min.js" defer></script><script src="/js/jquery.qrcode.min.js" defer></script><script type="module">import qrcodeInit from"/js/qrcode.js";qrcodeInit()</script><script type="module">window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(n){window.setTimeout(n,100)},window.cancelAnimationFrame=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||clearTimeout</script><script type="module">function get_poem(e,n){var t=document.querySelector(e),o=document.querySelector(n),i=new XMLHttpRequest;i.open("get","https://v2.jinrishici.com/one.json?client=browser-sdk/1.2"),i.withCredentials=!0,i.onreadystatechange=function(){if(4===i.readyState){var e=JSON.parse(i.responseText);t.innerHTML=e.data.content,o.innerHTML="["+e.data.origin.dynasty+"] "+e.data.origin.author+"ã€Š"+e.data.origin.title+"ã€‹"}},i.send()}function modifySubmitBtn(){var e=$(".hbe-button"),n=$("#hbePass");e.length>0&&e.text("é‡æ–°è¾“å…¥å¯†ç "),n.length>0&&n.attr("autocomplete","false")}function layoutTagCloud(){}function loopHover(){var e=$(".tagcloud a"),n=$('.tagcloud a[class="tag-hover"]'),t=Math.round(Math.random()*(e.length-1));if(t<0&&(t=0),t>e.length&&(t=e.length-1),e.length){if(n.length)for(let e=0;e<n.length;e++)n[e].classList="";e[t].classList="tag-hover"}}function setIntervalPrecision(e,n){let t=window.interValPrecisionObj||(window.interValPrecisionObj={num:0});t.num++,t["n"+t.num]=!0;var o=t.num,i=+new Date,a=0;return n=n||0,function r(){t["n"+o]&&(+new Date>i+n*(a+1)&&(a++,e(a)),window.requestAnimationFrame(r))}(),o}function clearIntervalPrecision(e){window.interValPrecisionObj&&(window.cancelAnimationFrame("n"+e),delete window.interValPrecisionObj["n"+e])}$("div").hasClass("poem-wrap")&&get_poem("#poem","#info"),modifySubmitBtn(),setIntervalPrecision(loopHover,100),window.revealLoading=revealLoading</script></body></html>